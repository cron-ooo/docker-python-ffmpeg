# python-ffmpeg
FFmpeg Docker image 

Собранные Docker-образы можно найти https://hub.docker.com/r/wladimi/python-ffmpeg

За базовый образ был взят python:3.9.5-slim-buster, это официальный python образ, ставить самостоятельно в дебиан эту версию излишний труд. Образ с основанный на Debian был взят специально, так как виртуалка с видеокартой для которой готовится этот базовый образ с Debian 10 обновлённый до backports, тут в образе мы тоже ставим пакеты с backports, это необходимо чтобы добиться совместимости библиотек и api cuda. Если я верно понял, то в Docker образе библиотеки должны быть или такие же как на хосте или же по крайней мере не свежее, если они свежее, то происходит конфликт api cuda. Идеально если они совпадают по версиям, к этому и стоит стремиться.

Исходя из того что описано вышу нужно быть аккуратным и следить что после пересборки базового образа у нас версии api cuda совпадают на хосте и в образе, так как в образ прилетит последнее доступное в репозиториях, а значит если не обновить хост, то работа cuda сломается.

1. Для работы образа на хосте должен быть установлен Debian 10 обновлённый до бекпортов и с драйверами из бекпортов.


2. Docker среда для выполнения должна быть анстроена согласно иструкции 
https://github.com/NVIDIA/nvidia-container-runtime


3. На хосте должны быть установлены библиотеки для работы с cuda

https://packages.debian.org/buster-backports/libcuda1

https://packages.debian.org/buster-backports/libcudart11.0


Пример команды которой можно запустить контейнер с пробросом в него видеокарты

docker run -ti -v /video:/mnt --gpus all wladimi/python-ffmpeg:3.9.5-slim-buster bash


Пример команды внутри контейнера

ffmpeg -y -hwaccel cuvid -c:v h264_cuvid -i "/mnt/Окружающий_мир__3_класс_55урок.mp4" -vf scale_npp="-2:480" -c:v h264_nvenc -preset slow "/tmp/SampleVideo_1280x720_10mbk9g38pcr_480p.mp4"
